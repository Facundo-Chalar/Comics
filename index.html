<html lang="en" >
<head>
  <title>Comics Thor</title>
  <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/angular_material/1.0.0/angular-material.min.css">
  <link rel="stylesheet" href="assets/style/style.css">

  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-route.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-animate.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-aria.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-messages.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angular_material/1.0.0/angular-material.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ngStorage/0.3.6/ngStorage.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-cookies.js"></script>
	<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.10.0/ui-bootstrap-tpls.min.js"></script>

  <script src="app/app.module.js"></script>
  <script src="app/app.route.js"></script>
  <script src="component/users/UserService.js"></script>
  <script src="component/login/loginController.js"></script>
  <script src="component/register/registerController.js"></script>
  <script src="shared/directives/passwordConfirm.js">
  </script>

  <script>
  var app=angular.module('comics');
  app.factory('RoleService', function ($http) {

  'use strict';

  var adminRoles = ['admin', 'editor'];
  var otherRoles = ['user'];

  return {
    validateRoleAdmin: function (currentUser) {
      return currentUser ? _.contains(adminRoles, currentUser.role) : false;
    },

    validateRoleOther: function (currentUser) {
      return currentUser ? _.contains(otherRoles, currentUser.role) : false;
    }
  };
});

app.factory('AuthenticationService', function ($http, SessionService) {

  'use strict';

  return {

    login: function (user) {

      SessionService.currentUser = user;
    },
    logout: function(){

      SessionService.currentUser=null;
    },
    isLoggedIn: function () {

      return SessionService.currentUser !== null;
    }
  };
});

app.factory('SessionService', function () {
  'use strict';
  
  return {  
   currentUser: null
  };
});

angular.module('comics').controller('comicsController',function($scope,$http){

      $http.get('assets/json/comics.json').success(function(data) {
        $scope.listacomics=data;
      });

	  
      $scope.order = function(predicate) {
        $scope.reverse = ($scope.predicate === predicate) ? !$scope.reverse : false;
        $scope.predicate = predicate;

      };
});

angular.module('comics').controller('currentUserController',function($scope,SessionService,AuthenticationService,UserService, $mdDialog,$location,$cookies){
    $scope.currentUser=function(){
		var userCookie=$cookies.get('user');
		if(userCookie!=null && userCookie!=''){
		var searchResult=UserService.findUser(userCookie);		
			SessionService.currentUser=searchResult;
		}
		if(SessionService.currentUser!==null){
			return SessionService.currentUser;
	   }else{
		 $location.path('/login');
		 return null;
	   }
    };

    $scope.logout=function(){
	   	  AuthenticationService.logout();
		    $cookies.remove('user');
		    $location.url('/login');
    };
    $scope.showAdvanced = function(ev) {
      
      $mdDialog.show({
        controller: DialogController,
        templateUrl: '/component/users/profile-dialog.html',
        parent: angular.element(document.body),
        targetEvent: ev,
        clickOutsideToClose:true,
        fullscreen: true
      })
      .then(function() {
        //Register acepted
      }, function() {

      });
    };

});
  </script>

</head>

<body ng-app="comics" ng-cloak ng-view ng-style="{'background-image':'url(/assets/img/LoginBackground.jpg)','background-position':'center','background-repeat':'no-repeat'}">

  <script type="text/javascript">
        angular.module('comics')
          .config(function($mdThemingProvider) {
              $mdThemingProvider.theme('default')
              .primaryPalette('blue')
              .accentPalette('red');
            });		
  </script>
</body>
</html>
